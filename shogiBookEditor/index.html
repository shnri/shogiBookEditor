<html>
  <head id="header">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta
      name="description"
      content="「かんたん棋書エディタ」ではWordや面倒な設定を必要とせず、市販されている棋書に近いレイアウトで図面と文章を表示してPDFに保存することができます。棋書の作成、研究ノート、指導等のためのテキスト作成など、幅広く利用できるかと思いますのでご活用ください。"
    />
    <link rel="stylesheet" type="text/css" href="css/jquery-ui.css" />
    <link rel="stylesheet" type="text/css" href="css/jquery.modal.css" />
    <link rel="stylesheet" type="text/css" href="css/format.css" />
    <link rel="stylesheet" type="text/css" href="css/zumen.css" />
    <link rel="stylesheet" type="text/css" href="css/menu.css" />
    <link rel="stylesheet" type="text/css" href="css/input.css" />
    <link rel="stylesheet" type="text/css" href="css/output.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="css/output-zumen-header.css"
      id="output-zumen-header"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="css/writing-mode-horizontal.css"
      id="writing-mode-horizontal"
      disabled
    />
    <link rel="stylesheet" type="text/css" href="css/selectBox.css" />
    <!-- フォント -->
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@200;400&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Sawarabi+Mincho"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Sawarabi+Gothic&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Piazzolla:wght@100&family=Playfair+Display&display=swap"
      rel="stylesheet"
    />
    <!-- 印刷用CSS -->
    <link rel="stylesheet" type="text/css" href="css/print.css" />
    <script type="text/javascript" src="js/jquery-3.5.1.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="js/jquery.cookie.js"></script>
    <script type="text/javascript" src="js/book.js"></script>
    <script type="text/javascript" src="js/page.js"></script>
    <script type="text/javascript" src="js/shogizumen.js"></script>
    <script type="text/javascript" src="js/selectBox.js"></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.2/jquery.modal.min.js"
    ></script>
    <script type="text/javascript" src="js/vue.min.js"></script>
    <script type="text/javascript" src="js/shogi-io.min.js"></script>
    <script type="text/javascript" src="js/shogi-board.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/shogiboard.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@mdi/font@5.x/css/materialdesignicons.min.css"
    />
  </head>
  <body>
    <div class="contents">
      <header>
        <title>かんたん棋書エディタ</title>
        <form name="myform">
          <div class="icon-box">
            <div style="display: flex">
              <div id="saveBtn" class="icon">
                <div>
                  <img src="img/save.png" alt="download" />
                </div>
                <div>保存</div>
              </div>
              <div id="uploadBtn" class="icon">
                <div>
                  <img src="img/upload.png" alt="upload" />
                </div>
                <div>読込</div>
              </div>
              <div id="newpageBtn" class="icon">
                <div>
                  <img src="img/newpage.png" alt="newpage" />
                </div>
                <div>追加</div>
              </div>
              <div id="deleteBtn" class="icon">
                <div>
                  <img src="img/delete.png" alt="delete" />
                </div>
                <div>削除</div>
              </div>
              <div id="reloadBtn" class="icon">
                <div>
                  <img src="img/reload.png" alt="reload" />
                </div>
                <div>更新</div>
              </div>
              <div class="icon" id="left-panel-link" href="#left-panel">
                <div>
                  <img src="img/shogi.png" alt="info" />
                  <div>将棋盤</div>
                </div>
              </div>
              <div style="display: none">
                <input name="myfile" type="file" accept=".html" />
              </div>
            </div>
            <div style="display: flex; margin-right: 30px">
              <div id="infoBtn" class="icon">
                <div>
                  <img src="img/info.png" alt="info" />
                </div>
                <div>情報</div>
              </div>
              <div id="helpBtn" class="icon">
                <div>
                  <img src="img/help.png" alt="upload" />
                </div>
                <div>使い方</div>
              </div>
              <div id="configBtn" class="icon">
                <div>
                  <img src="img/config.png" alt="config" />
                </div>
                <div>設定</div>
              </div>
            </div>
          </div>
        </form>
      </header>

      <div id="book"></div>
    </div>
    <div id="helpDialog" title="使い方">
      <h2>はじめに</h2>
      <p>
        「かんたん棋書エディタ」ではWordや面倒な設定を必要とせず、市販されている棋書に近いレイアウトで図面と文章を表示してPDFに保存することができます。
        <br />
        かんたん棋書エディタを用いて制作したPDFを商用利用することは問題ございません。
        <br />
        かんたん棋書エディタを利用することで発生したいかなる損害も、当方は責任を負いませんので予めご了承ください。
      </p>
      <h2>解説動画</h2>
      <p>
        YouTubeの使い方ガイドの動画を参照ください→
        <a href="https://youtu.be/e14W3cpXCR4" target="_blank" rel="youtube"
          >こちら</a
        >
      </p>
      <h2>ボタン説明</h2>
      <h3><img class="smallImg" src="img/save.png" alt="download" />保存</h3>
      <div>
        htmlファイルがダウンロードできます。ブラウザで開くと画面中央のビューアーのみを切り取ったものが表示されます。用途は下記の２点です。
        <ol>
          <li>
            ブラウザの印刷にはPDFに保存する機能があるので、これを利用して出力した図面と文章をPDFに保存することができます。
          </li>
          <li>
            内容を編集したいときは[読込]ボタンを押下してhtmlファイルを選択すれば読み込むことができます。
          </li>
        </ol>
      </div>
      <h3><img class="smallImg" src="img/upload.png" alt="upload" />読込</h3>

      <div>
        [保存]ボタンでダウンロードしたhtmlファイルを読み込むことができます。それ以外のファイルは読み込めません。ページが選択されているときはその直下に読み込んだページを追加します。選択されていなければ一番下に追加します。
      </div>

      <h3><img class="smallImg" src="img/newpage.png" alt="newpage" />追加</h3>
      <div>
        新しいページを追加します。ページが選択されているときはその直下に追加します。選択されていなければ一番下に追加します。ページのレイアウトは
        [設定]＞[追加ページのレイアウト]から選択できます。
      </div>
      <h3><img class="smallImg" src="img/delete.png" alt="delete" />削除</h3>
      <div>
        選択されているページを削除します。削除したページを復元する機能はありません。
      </div>
      <h3><img class="smallImg" src="img/reload.png" alt="reload" />更新</h3>
      <div>
        次に説明する機能を使用したときに図面番号の更新を行います。
        <h4>図面番号の自動連番機能について</h4>
        <div>
          図面番号を手動で入力していると、図面の追加や削除が発生したときに番号がずれてしまい大変です。そのため、自動で連番にする機能を設けています。例えば複数の図面のヘッダーの入力欄にそれぞれ
          <ol>
            <li>第(groupIDa_IDx)図</li>
            <li>第(groupIDa_IDy)図</li>
            <li>第(groupIDa_IDz)図</li>
            <li>第(groupIDb_IDx)図</li>
            <li>第(groupIDb_IDy)図</li>
            <li>第(groupIDb_IDz)図</li>
          </ol>
          と入力して[更新]ボタンを押下するとそれぞれ以下のように出力されます。
          <ol>
            <li>第１図</li>
            <li>第２図</li>
            <li>第３図</li>
            <li>第１図</li>
            <li>第２図</li>
            <li>第３図</li>
          </ol>
          <b>(グループID_ID)</b
          >(グループID、IDは英数字)の形式で書くことで機能を利用することができます。グループIDが同じであればグループ毎に連番にします。
        </div>
      </div>
      <h3><img class="smallImg" src="img/config.png" alt="config" />設定</h3>
      <ul>
        <li><h4>追加ページのレイアウト</h4></li>
        <div>
          ページのレイアウトを選択します。[追加]ボタンを押下することで選択したページを追加します。
        </div>
        <li><h4>追加ページの図面 詰将棋用レイアウト</h4></li>
        <div>
          有効に設定すると[追加]ボタンを押下したページで詰将棋用の図面が作成できます。
        </div>
        <li><h4>ページ選択</h4></li>
        <div>
          有効に設定するとページが選択可能になります。ページをクリックするとページが選択状態になります。CTRLキーを押しながら選択すると複数のページを選択できます。マウスドラッグによる複数選択も可能です。
        </div>
        <h5>ページ選択でできること</h5>
        <div>
          <ul>
            <li>[削除]ボタン押下で選択状態のページを削除</li>
            <li>選択状態のページをドラッグ＆ドロップで並び変える</li>
            <li>ページの追加位置が選択状態のページの直下になる</li>
          </ul>
        </div>
        <li><h4>ヘッダー</h4></li>
        <div>
          ヘッダーの表示非表示を切り替えます。ヘッダーには各ページにページ番号、奇数ページにタイトルが表示されます。
          <h5>タイトルの表示について</h5>
          [追加ページのレイアウト]で「タイトル」または「1図面(タイトル)」を選択し、追加したページにタイトルを入力することで、ヘッダーにそのタイトルを表示できます。例えば、「タイトル」ページに「第１章」（１ページ目）、「1図面(タイトル)」ページに「第１節」（２ページ目）とタイトルを入力すると３ページ以降の奇数ページに「第１章　/　第１節」が表示されます。
        </div>
        <li><h4>図面ヘッダー括弧</h4></li>
        <div>
          図面ヘッダー括弧の表示非表示を切り替えます。都度【】を入力する手間を省くことができます。
        </div>
        <li><h4>保存ファイル名</h4></li>
        <div>
          [保存]ボタン押下でファイルを保存するときのファイル名を指定できます。
        </div>
      </ul>
      <h2>エディタ</h2>
      テキストエリアまたはテキストボックスに文字を入力すると中央のページ（プレビュー）に出力されます。
      <ul>
        <li><h4>HTMLタグ使用可</h4></li>
        例えば文字を強調したい場合は
        <p>&lt;b&gt;太字にしたい文字&lt;/b&gt</p>
        と入力するとよいでしょう。
        <li><h4>英数字の向き（縦中横）</h4></li>
        縦書きで数字を横にしたいときはパーセントで囲うと出力できます。例えば
        <p>%10%</p>
        と入力するとよいでしょう。
        <li><h4>図面について</h4></li>
        <div>
          左側のテキストエリアにBOD形式の盤面テキストを入力するとSVGの図面が出力されます。<br />
          BOD形式とは以下のような形式です。
        </div>
        <pre style="font-size: 16px">
後手の持駒：なし
９ ８ ７ ６ ５ ４ ３ ２ １
+---------------------------+
|v香v桂v銀v金v玉v金 ・v桂v香|一
| ・ ・ ・ ・ ・v飛 ・v角 ・|二
| ・v歩v歩v歩v歩v銀 ・v歩v歩|三
|v歩 ・ ・ ・ ・v歩v歩 ・ ・|四
| ・ ・ ・ ・ ・ ・ ・ ・ ・|五
| 歩 ・ 歩 ・ ・ ・ ・ 歩 ・|六
| ・ 歩 ・ 歩 歩 歩 歩 ・ 歩|七
| ・ 角 ・ 玉 金 銀 ・ 飛 ・|八
| 香 桂 銀 金 ・ ・ ・ 桂 香|九
+---------------------------+
先手の持駒：なし
手数＝12  △４二飛  まで
              </pre
        >
        <div>
          BOD形式の盤面テキストは以下などの棋譜再生ソフトを使用することで出力できます。
        </div>
        <ul>
          <li>Kifu for Windows [編集] > [局面のコピー]</li>
          <li>将棋所 [編集] > [局面コピー(KIF/KI2形式)]</li>
          <li>ShogiGUI [編集] > [局面コピー] > [BOD]</li>
        </ul>
        <li><h4>図面番号の参照機能</h4></li>
        図面番号の自動連番機能を利用しているときに、自動で振られた図面番号を文章中で使用したいときがあります。そのときは図面のヘッダーのテキストボックスに入力した文字をそのまま使用してください。例えば、図面のヘッダーに「第(groupIDa_IDx)図」と入力しているならば、他のテキストエリアで「第(groupIDa_IDx)図」と入力すれば同じ図面番号が出力されます。
        <li><h4>最終指し手の取得</h4></li>
        BOD形式の盤面テキストに最終指し手があるとき、図面のヘッダーのテキストボックスに<b>move</b>と入力すると最終指し手に置換されます。例えば
        <p>第A図はmoveまで</p>
        と入力すると
        <p>第A図は☖４二飛まで</p>
        などのように置換されます。
      </ul>
      <h2>ページのPDF出力</h2>
      ブラウザの機能を利用して以下の手順でPDFを出力できます。
      <ol>
        <li>[保存]ボタン押下でhtmlファイルをダウンロードします。</li>
        <li>保存したhtmlファイルを開き、CTRL+Pなどで印刷を表示します。</li>

        <li>
          出力をPDFに選択して保存してください。Chromeの場合は下記の画像のようになります。ページ数が多い場合は数分かかることもあります。
        </li>
        <img
          src="img/print.png"
          alt="print"
          style="width: 50%; height: auto; border: solid"
        />
      </ol>
    </div>
    <nav>
      <div class="flex-container">
        <div class="bullet flex-item"></div>
        <div class="config-label flex-item">追加ページのレイアウト</div>
      </div>
      <div class="center flex-container">
        <select
          name="pageType"
          id="pageType"
          class="custom-select sources flex-item"
          placeholder="タイトル"
        >
          <option value="cover">タイトル</option>
          <option value="3zumenGuide">ガイド</option>
          <option value="1zumen">1図面(タイトル)</option>
          <option value="1zumenNotTitle">1図面(図面上)</option>
          <option value="1zumenOnly">1図面(図面中央)</option>
          <option value="1zumenTreeDiagram">1図面(樹形図用)</option>
          <option value="2zumen">2図面(図面左)</option>
          <option value="2zumenTop">2図面(図面上)</option>
          <option value="2zumenOnly">2図面(図面中央)</option>
          <option value="3zumen">3図面</option>
          <option value="4zumen">4図面</option>
          <option value="6zumen">6図面</option>
          <option value="nextMove">指しこな本形式</option>
          <option value="verticalTextOnly1Lines">縦書き</option>
          <option value="verticalTextOnly2Lines">縦書き(2段)</option>
          <option value="horizontalTextOnly">横書き</option>
          <option value="dummy"></option>
        </select>
      </div>
      <div class="flex-container">
        <div class="bullet flex-item"></div>
        <div class="config-label flex-item">追加ページの図面</div>
      </div>
      <div class="center flex-container">
        <select
          name="zumenType"
          id="zumenType"
          class="custom-select sources flex-item"
          placeholder="通常"
        >
          <option value="normal">通常</option>
          <option value="tsumeShogi">詰将棋</option>
          <option value="rotationDiagram">先後反転</option>
          <option value="dummy"></option>
        </select>
      </div>
      <div class="flex-container">
        <div class="bullet flex-item"></div>
        <div class="config-label flex-item">ページ選択</div>
      </div>
      <div class="container flex-container">
        <p id="selectableLabel" class="flex-item checkbox-label">無効</p>
        <div class="flex-item">
          <div>
            <input type="checkbox" id="selectable" />
            <label for="selectable"></label>
          </div>
        </div>
      </div>
      <div class="flex-container">
        <div class="bullet flex-item"></div>
        <div class="config-label flex-item">ヘッダー</div>
      </div>
      <div class="container flex-container">
        <p id="headerview" class="flex-item checkbox-label">非表示</p>
        <div class="flex-item">
          <div>
            <input type="checkbox" id="headerviewcheckbox" />
            <label for="headerviewcheckbox"></label>
          </div>
        </div>
      </div>
      <div class="flex-container">
        <div class="bullet flex-item"></div>
        <div class="config-label flex-item">図面ヘッダー括弧</div>
      </div>
      <div class="container flex-container">
        <p id="zumenHeaderBrackets" class="flex-item checkbox-label">表示</p>
        <div class="flex-item">
          <div>
            <input
              type="checkbox"
              id="zumenHeaderBracketsCheckbox"
              checked="checked"
            />
            <label for="zumenHeaderBracketsCheckbox"></label>
          </div>
        </div>
      </div>
      <div class="flex-container">
        <div class="bullet flex-item"></div>
        <div class="config-label flex-item">縦書き→横書き</div>
      </div>
      <div class="container flex-container">
        <p id="horizontalWriting" class="flex-item checkbox-label">無効</p>
        <div class="flex-item">
          <div>
            <input type="checkbox" id="horizontalWritingCheckbox" />
            <label for="horizontalWritingCheckbox"></label>
          </div>
        </div>
      </div>
      <div class="flex-container">
        <div class="bullet flex-item"></div>
        <div class="config-label flex-item">保存ファイル名</div>
      </div>
      <div class="center flex-container">
        <input input type="text" name="fileName" id="fileName" />
      </div>
    </nav>

    <div id="left-panel" class="panel">
      <shogi-io />
    </div>
    <div class="overlay"></div>
    <a id="getLocal" href="#"></a>
    <div id="info" class="modal">
      <p>名称：かんたん棋書エディタ</p>
      <p>Version: 1.7.0 (2022-09-10)</p>
      <p>対応ブラウザ：Chrome</p>
      <p>
        連絡：<a
          href="https://twitter.com/shogishinri"
          target="_blank"
          rel="twitter"
          >@shogishinri</a
        >
      </p>
      <p>
        解説動画：
        <a href="https://youtu.be/e14W3cpXCR4" target="_blank" rel="youtube"
          >こちら</a
        >
      </p>
    </div>

    <!-- Link to open the modal -->
    <a href="https://twitter.com/shogishinri"></a>
    <p><a href="#info" id="infoLink" rel="modal:open"></a></p>
    <script src="js/jquery.panelslider.min.js"></script>
    <script>
      $("#left-panel-link").panelslider({
        clickClose: false,
      });
      $("#left-panel-link").click(function () {
        $("header").toggleClass("widthHeader");
      });
      $("#book").selectable({
        cancel:
          ".sort-handle, .ui-selected,input,textarea,button,select,option",
        filter: ".page",
      });
      $("#book").sortable({
        axis: "y",
        opacity: 0.9,
        items: ".page",
        handle: "div, .sort-handle, .ui-selected",
        //ヘルパー生成時（ドラッグ時）処理
        helper: function (e, item) {
          if (!item.hasClass("ui-selected")) {
            item.parent().children(".ui-selected").removeClass("ui-selected");
            item.addClass("ui-selected");
          }
          var selected = item.parent().children(".ui-selected").clone();
          //placeholder用の高さを取得しておく
          ph = item.outerHeight() * selected.length;
          item.data("multidrag", selected).siblings(".ui-selected").remove();
          return $("<li/>").append(selected);
        },
        //ドラッグした時にplaceholderの高さを選択要素分取る
        start: function (e, ui) {
          ui.placeholder.css({ height: ph });
        },
        //ドロップ時処理
        stop: function (e, ui) {
          var selected = ui.item.data("multidrag");
          ui.item.after(selected);
          ui.item.remove();
          linkZumenNo();
          changeHeader();
        },
      });
      $(document).ready(function () {
        var html = localStorage.getItem(localStorageAutoSaveKye);
        if (html !== null) {
          var res = window.confirm("前回の内容を復元しますか？");
          if (res) {
            restore($(html));
          } else {
            localStorage.clear();
          }
        }
      });
    </script>
  </body>
</html>
